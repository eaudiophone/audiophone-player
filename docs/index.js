"use strict";(()=>{var k=Object.defineProperty,S=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable;var T=(t,e,a)=>e in t?k(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,s=(t,e)=>{for(var a in e||(e={}))b.call(e,a)&&T(t,a,e[a]);if(m)for(var a of m(e))h.call(e,a)&&T(t,a,e[a]);return t},c=(t,e)=>S(t,v(e));navigator.serviceWorker&&navigator.serviceWorker.register("./sw.js");function L(t){return{playlist:[],selectedTrack:null,audio:null,setPlaylist:a=>t(r=>c(s({},r),{playlist:a})),setSelectedTrack:a=>t(r=>c(s({},r),{selectedTrack:a})),setAudio:({filePath:a,format:r})=>t(l=>{l.audio&&l.audio.unload();let u=l.audio=new Howl({src:[a],html5:!0,format:[r],onload:()=>{n.buttonPlay.getAttribute("value")==="play"&&n.buttonPlay.click()},onloaderror:(i,d)=>{console.error("Error al cargar el audio",a,d)},onplay:()=>{if(!n.durationTrack)return;let i=u.duration();n.durationTrack.innerHTML=f(Math.round(i)),requestAnimationFrame(y)},onend:()=>{n.buttonPlay.getAttribute("value")==="pause"&&n.buttonPlay.click(),l.selectedTrack&&l.selectedTrack.index!==l.playlist.length-1&&n.nextTrack.click()},onseek:()=>{requestAnimationFrame(y)}});return c(s({},l),{audio:u})})}}function f(t){let e=Math.floor(t/60)||0,a=t-e*60||0;return`${e}:${a<10?"0":""}${a}`}function y(){let{audio:t}=o.getState(),e=t.seek()||0;n.timerTrack&&(n.timerTrack.innerHTML=f(Math.round(e)));let a=e/t.duration()*100||0;n.progress&&(n.progress.value=a.toString(),n.progress.style.background=`linear-gradient(to right, var(--color-indicators) ${a}%, var(--borders) ${a}%)`),t.playing()&&requestAnimationFrame(y)}function g(t="next"){let{playlist:e,selectedTrack:a,audio:r,setSelectedTrack:l,setPlaylist:u}=o.getState();if(e.length===0||!a)return;let i=a.index||0;t==="prev"&&(i=a.index-1,i<0&&(i=e.length-1)),t==="next"&&(i=a.index+1,i>=e.length&&(i=0)),r.stop(),n.buttonPlay.getAttribute("value")==="pause"&&n.buttonPlay.click(),n.progress.value="0",n.progress.style.background="var(--borders)";let d=e.map(p=>p.index===i?c(s({},p),{selected:!0}):c(s({},p),{selected:!1}));u(d),l(e[i])}function E(t){let{playlist:e,selectedTrack:a,audio:r}=o.getState();if(e.length===0||!a)return;let l=t.clientX/window.innerWidth;r.playing()&&r.seek(r.duration()*l)}function P(t){let e=o.getState();if(e.playlist.length===0){console.error("No tracks loaded ...");return}let a=e.playlist.map(l=>l.index===t?c(s({},l),{selected:!0}):c(s({},l),{selected:!1}));e.setPlaylist(a);let r=a.find(l=>l.index===t)||null;r&&e.setSelectedTrack(r)}async function x(){let t=await w();if(t.length===0)return;let e=o.getState();window.sessionStorage.setItem("playlist",JSON.stringify(t)),e.setPlaylist(t)}async function w(){return new Promise(t=>{n.inputFile.addEventListener("input",e=>{let{files:a}=e.target,r=[];for(let l of a)r=[...r,{selected:!1,index:r.length,name:l.name||"",filePath:URL.createObjectURL(l),format:l.type.split("/")[1]}];t(r)},{once:!0}),n.inputFile.click()})}function A(t){let e=o.getState(),a=t.target.value,r=[];if(a.length===0)r=JSON.parse(window.sessionStorage.getItem("playlist")||"{}").map(l=>e.selectedTrack&&l.index===e.selectedTrack.index?c(s({},l),{selected:!0}):l);else{if(a=a.toLowerCase(),!/^[\w\s\d]{1,255}$/.test(a)){console.error(new Error("Solo caracteres alfan\xFAmericos"));return}r=e.playlist.filter(l=>l.name.toLowerCase().search(a)!==-1)}e.setPlaylist(r)}function H(){let{audio:t}=o.getState();t.stop(),n.buttonPlay.setAttribute("value","pause"),n.buttonPlay.setAttribute("src","img/play.svg"),n.buttonPlay.click()}function M(t,e){if(t.playlist===e.playlist||t.playlist.length===0)return;n.playListData.innerHTML=t.playlist.map(r=>`
            <div class="item ${r.selected?"selected":""}" track="${r.index}">
                <img src="img/play.svg" alt="play" class="icons" />
                <span>${r.name.length>35?r.name.slice(0,35)+"...":r.name}</span>
            </div>    
        `).join(""),Array.from(n.playListData.querySelectorAll(".item")).forEach(r=>r.addEventListener("click",()=>P(Number(r.getAttribute("track")))))}function q(t,e){if(t.selectedTrack!==e.selectedTrack&&n.titleTrack){if(!t.selectedTrack){n.titleTrack.innerText="No track loaded";return}t.audio&&t.audio.playing()&&H(),n.titleTrack.innerText=t.selectedTrack.name,t.setAudio({filePath:t.selectedTrack.filePath,format:t.selectedTrack.format||"mp3"})}}function N(t){let e=t.target,a=Number(e.value),r=Number(e.max),l=a/r*100;e.style.background=`linear-gradient(to right, var(--foreground) ${l}%, var(--borders) ${l}%)`,Howler.volume(a/100)}function $({target:t}){let{audio:e,playlist:a,selectedTrack:r}=o.getState();if(a.length===0||!r)return;let u=t.getAttribute("value");u==="pause"&&(t.setAttribute("value","play"),t.setAttribute("src","img/play.svg"),e&&e.state()==="loaded"?e.pause():e&&e.state()!=="loading"&&console.warn("No se ha cargado ning\xFAn archivo de audio o a\xFAn est\xE1 cargando.")),u==="play"&&(t.setAttribute("value","pause"),t.setAttribute("src","img/pause.svg"),e&&e.state()==="loaded"?e.play():e&&e.state()!=="loading"&&console.warn("No se ha cargado ning\xFAn archivo de audio o a\xFAn est\xE1 cargando."))}var n={uploadButton:document.querySelector("button#load-playlist"),inputFile:document.querySelector("#upload-input"),playListData:document.querySelector("#playlist #data"),inputSearch:document.querySelector("#search"),player:document.querySelector("footer#player"),volume:document.querySelector("footer #indicator-volume"),buttonPlay:document.querySelector("#play-pause"),durationTrack:document.querySelector("span#duration"),timerTrack:document.querySelector("span#timer"),progress:document.querySelector("#progress"),nextTrack:document.querySelector("#next"),prevTrack:document.querySelector("#prev"),titleTrack:document.querySelector("#title-track")},o=zustandVanilla.createStore(L);o.subscribe(M);o.subscribe(q);n.uploadButton.addEventListener("click",x);n.buttonPlay.addEventListener("click",$);n.volume.addEventListener("input",N);n.inputSearch.addEventListener("input",A);n.prevTrack.addEventListener("click",()=>g("prev"));n.nextTrack.addEventListener("click",()=>g("next"));n.progress.addEventListener("click",E);})();
//# sourceMappingURL=index.js.map
