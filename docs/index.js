(()=>{var b=Object.defineProperty,S=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var T=(t,e,r)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,u=(t,e)=>{for(var r in e||(e={}))x.call(e,r)&&T(t,r,e[r]);if(k)for(var r of k(e))P.call(e,r)&&T(t,r,e[r]);return t},d=(t,e)=>S(t,w(e));var L=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var B=L(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("./sw.js");var m=window.matchMedia("screen and (max-width: 768px)").matches,l=m?"#mobile":"#desktop",a={uploadButton:document.querySelector(l+" button#load-playlist"),inputFile:document.querySelector(l+" #upload-input"),playListData:document.querySelector(l+" #playlist #data"),inputSearch:document.querySelector(l+" #search"),player:document.querySelector(l+" footer#player"),volume:document.querySelector(l+" footer #indicator-volume"),buttonPlay:document.querySelector(l+" #play-pause"),durationTrack:document.querySelector(l+" span#duration"),timerTrack:document.querySelector(l+" span#timer"),progress:document.querySelector(l+" #progress"),nextTrack:document.querySelector(l+" #next"),prevTrack:document.querySelector(l+" #prev"),titleTrack:document.querySelector(l+" #title-track")};function A(t){return{playlist:[],selectedTrack:null,audio:null,setPlaylist:r=>t(n=>d(u({},n),{playlist:r})),setSelectedTrack:r=>t(n=>d(u({},n),{selectedTrack:r})),setAudio:({filePath:r,format:n})=>t(i=>{i.audio&&i.audio.unload();let s=i.audio=new Howl({src:[r],html5:!0,format:[n],onload:()=>{a.buttonPlay.getAttribute("value")==="play"&&a.buttonPlay.click()},onloaderror:(o,p)=>{console.error("Error al cargar el audio",r,p)},onplay:()=>{if(!a.durationTrack)return;let o=s.duration();a.durationTrack.innerHTML=v(Math.round(o)),requestAnimationFrame(g)},onend:()=>{a.buttonPlay.getAttribute("value")==="pause"&&a.buttonPlay.click(),i.selectedTrack&&i.selectedTrack.index!==i.playlist.length-1&&a.nextTrack.click()},onseek:()=>{requestAnimationFrame(g)}});return d(u({},i),{audio:s})})}}function E(t){let e=c.getState();if(e.playlist.length===0){console.error("No tracks loaded ...");return}let r=e.playlist.map(i=>i.index===t?d(u({},i),{selected:!0}):d(u({},i),{selected:!1}));e.setPlaylist(r);let n=r.find(i=>i.index===t)||null;e.setSelectedTrack(n)}async function q(){let t=await j();if(t.length===0)return;let e=c.getState();window.sessionStorage.setItem("playlist",JSON.stringify(t)),e.setPlaylist(t)}function N(t){let e=c.getState(),r=t.target.value,n=[];if(r.length===0)n=JSON.parse(window.sessionStorage.getItem("playlist")).map(i=>e.selectedTrack&&i.index===e.selectedTrack.index?d(u({},i),{selected:!0}):i);else{if(r=r.toLowerCase(),!/^[\w\s\d]{1,255}$/.test(r)){console.error(new Error("Solo caracteres alfan\xFAmericos"));return}n=e.playlist.filter(i=>i.name.toLowerCase().search(r)!==-1)}e.setPlaylist(n)}function $(){let{audio:t}=c.getState();t.stop(),a.buttonPlay.setAttribute("value","pause"),a.buttonPlay.setAttribute("src","img/play.svg"),a.buttonPlay.click()}function M(t,e){if(t.playlist===e.playlist||t.playlist.length===0)return;a.playListData.innerHTML=t.playlist.map(n=>`
            <div class="item ${n.selected?"selected":""}" track="${n.index}">
                <img src="img/play.svg" alt="play" class="icons" />
                <span>${n.name.length>35?n.name.slice(0,35)+"...":n.name}</span>
            </div>    
        `).join(""),Array.from(a.playListData.querySelectorAll(".item")).forEach(n=>n.addEventListener("click",()=>E(Number(n.getAttribute("track")))))}function F(t,e){if(t.selectedTrack!==e.selectedTrack&&a.titleTrack){if(!t.selectedTrack){a.titleTrack.innerText="No track loaded";return}t.audio&&t.audio.playing()&&$(),a.titleTrack.innerText=t.selectedTrack.name,t.setAudio({filePath:t.selectedTrack.filePath,format:t.selectedTrack.format})}}function R(t){let e=t.target,r=Number(e.value),n=Number(e.max),i=r/n*100;e.style.background=`linear-gradient(to right, var(--foreground) ${i}%, var(--borders) ${i}%)`,Howler.volume(r/100)}function H({target:t}){let{audio:e,playlist:r,selectedTrack:n}=c.getState();if(r.length===0||!n)return;let s=t.getAttribute("value");s==="pause"&&(t.setAttribute("value","play"),t.setAttribute("src","img/play.svg"),e&&e.state()==="loaded"?e.pause():e&&e.state()!=="loading"&&console.warn("No se ha cargado ning\xFAn archivo de audio o a\xFAn est\xE1 cargando.")),s==="play"&&(t.setAttribute("value","pause"),t.setAttribute("src","img/pause.svg"),e&&e.state()==="loaded"?e.play():e&&e.state()!=="loading"&&console.warn("No se ha cargado ning\xFAn archivo de audio o a\xFAn est\xE1 cargando."))}function v(t){let e=Math.floor(t/60)||0,r=t-e*60||0;return`${e}:${r<10?"0":""}${r}`}function g(){let{audio:t}=c.getState(),e=t.seek()||0;a.timerTrack&&(a.timerTrack.innerHTML=v(Math.round(e)));let r=e/t.duration()*100||0;a.progress&&(a.progress.value=r,a.progress.style.background=`linear-gradient(to right, var(--color-indicators) ${r}%, var(--borders) ${r}%)`),t.playing()&&requestAnimationFrame(g)}function h(t="next"){let{playlist:e,selectedTrack:r,audio:n,setSelectedTrack:i,setPlaylist:s}=c.getState();if(e.length===0)return;let o=r.index||0;t==="prev"&&(o=r.index-1,o<0&&(o=e.length-1)),t==="next"&&(o=r.index+1,o>=e.length&&(o=0)),n.stop(),a.buttonPlay.getAttribute("value")==="pause"&&a.buttonPlay.click(),a.progress.value=0,a.progress.style.background="var(--borders)";let p=e.map(y=>y.index===o?d(u({},y),{selected:!0}):d(u({},y),{selected:!1}));s(p),i(e[o])}function f(t){let{playlist:e,selectedTrack:r,audio:n}=c.getState();if(e.length===0||!r)return;let i=0;m&&t instanceof TouchEvent?i=t.touches[0].clientX:i=t.clientX;let s=i/window.innerWidth;n.playing()&&n.seek(n.duration()*s)}async function j(){return new Promise(t=>{a.inputFile.addEventListener("input",e=>{let{files:r}=e.target,n=[];for(let i of r)n=[...n,{selected:!1,index:n.length,name:i.name||"",filePath:URL.createObjectURL(i),format:i.type.split("/")[1]}];t(n)},{once:!0}),a.inputFile.click()})}if(!a.uploadButton)return;a.uploadButton.addEventListener("click",q);if(!a.inputSearch)return;a.inputSearch.addEventListener("input",N);if(!a.volume)return;a.volume.addEventListener("input",R);if(!a.buttonPlay)return;a.buttonPlay.addEventListener("click",H);if(!a.prevTrack)return;a.prevTrack.addEventListener("click",()=>h("prev"));if(!a.nextTrack)return;a.nextTrack.addEventListener("click",()=>h("next"));if(!a.progress)return;m?(a.progress.addEventListener("touchstart",f),a.progress.addEventListener("touchend",f)):a.progress.addEventListener("click",f);var c=zustandVanilla.createStore(A);c.subscribe(M);c.subscribe(F)});B();})();
//# sourceMappingURL=index.js.map
